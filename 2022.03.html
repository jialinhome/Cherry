<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2022年3月 | 午后斜阳 暖暖橘黄</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="姜嘉林的网站">
    
    <link rel="preload" href="/Cherry/assets/css/0.styles.b9f34bb3.css" as="style"><link rel="preload" href="/Cherry/assets/js/app.5a1e4f07.js" as="script"><link rel="preload" href="/Cherry/assets/js/2.887b5b9f.js" as="script"><link rel="preload" href="/Cherry/assets/js/5.ceb362cc.js" as="script"><link rel="prefetch" href="/Cherry/assets/js/10.cd6f20a6.js"><link rel="prefetch" href="/Cherry/assets/js/11.3d57c49f.js"><link rel="prefetch" href="/Cherry/assets/js/12.bad96b18.js"><link rel="prefetch" href="/Cherry/assets/js/13.ec383881.js"><link rel="prefetch" href="/Cherry/assets/js/14.0e520a5e.js"><link rel="prefetch" href="/Cherry/assets/js/15.fd1ad449.js"><link rel="prefetch" href="/Cherry/assets/js/16.870a7b58.js"><link rel="prefetch" href="/Cherry/assets/js/17.dd48f4c7.js"><link rel="prefetch" href="/Cherry/assets/js/18.823f5b2d.js"><link rel="prefetch" href="/Cherry/assets/js/19.13a4ca37.js"><link rel="prefetch" href="/Cherry/assets/js/20.e93402a4.js"><link rel="prefetch" href="/Cherry/assets/js/21.ed0f4efe.js"><link rel="prefetch" href="/Cherry/assets/js/22.3196fb95.js"><link rel="prefetch" href="/Cherry/assets/js/23.1734bea6.js"><link rel="prefetch" href="/Cherry/assets/js/3.12fb9a5d.js"><link rel="prefetch" href="/Cherry/assets/js/4.ec6ff4f4.js"><link rel="prefetch" href="/Cherry/assets/js/6.e5c7fb3b.js"><link rel="prefetch" href="/Cherry/assets/js/7.9bbd28ae.js"><link rel="prefetch" href="/Cherry/assets/js/8.80f602c4.js"><link rel="prefetch" href="/Cherry/assets/js/9.b5eb54e3.js">
    <link rel="stylesheet" href="/Cherry/assets/css/0.styles.b9f34bb3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Cherry/" class="home-link router-link-active"><!----> <span class="site-name">午后斜阳 暖暖橘黄</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Cherry/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Cherry/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Cherry/" aria-current="page" class="sidebar-link">Orange</a></li><li><a href="/Cherry/2019.12.html" class="sidebar-link">2019年12月</a></li><li><a href="/Cherry/2020.01.html" class="sidebar-link">2020年1月</a></li><li><a href="/Cherry/2020.04.html" class="sidebar-link">2020年4月</a></li><li><a href="/Cherry/2020.05.html" class="sidebar-link">2020年5月</a></li><li><a href="/Cherry/2020.06.html" class="sidebar-link">2020年6月</a></li><li><a href="/Cherry/2020.07.html" class="sidebar-link">2020年7月-7月你好</a></li><li><a href="/Cherry/2020.08.html" class="sidebar-link">2020年8月</a></li><li><a href="/Cherry/2020.09.html" class="sidebar-link">2020年9月-金秋9月</a></li><li><a href="/Cherry/2020.10.html" class="sidebar-link">2020年10月</a></li><li><a href="/Cherry/2020.11.html" class="sidebar-link">2020年11月</a></li><li><a href="/Cherry/2021.02.html" class="sidebar-link">2021年2月</a></li><li><a href="/Cherry/2021.03.html" class="sidebar-link">2021 年 3 月</a></li><li><a href="/Cherry/2021.04.html" class="sidebar-link">2021 年 4 月</a></li><li><a href="/Cherry/2021.06.html" class="sidebar-link">2021.6</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2022年3月"><a href="#_2022年3月" class="header-anchor">#</a> 2022年3月</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>好久没有写了，去年太忙了，都是在做需求，没有时间整理，其实也不是完全没有时间，只是没有把这件事情当做第一优先级来做，所以就耽搁了。但是&quot;实迷途其未远&quot;，从新开始吧。</p> <p>自己心里有好几件事情想要去做，但都还没有如愿，记录于此：</p> <ol><li><p>学习中文语法知识。时长被&quot;的&quot;、&quot;地&quot;所困扰，一直不理解其使用方式，网上讲的也模棱两可，所以需要对中文语法进行学习，以期彻底吃透这两个字的正确使用方式，并且期望对于自己文笔有所提高。但这是一个漫长的过程，不是一蹴而就的，长期坚持下去。</p></li> <li><p>用可视化做一个烟花。过年的时候最喜欢看烟花了，所以期望用three.js实现烟花效果，年前的时候找到过一个挺好的例子，希望能在其基础上实现自己想要的效果。<a href="https://qake.se/fw/index.html" target="_blank" rel="noopener noreferrer">例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>做中国近代史的可视化。用类似地图层级的方式展开，第一层展示标题，第二层展示大纲，第三层展示细节等，还没有做调研，不知道是否有这样的实现。难点：技术实现和数据收集。</p></li> <li><p>文档迁移到 gitee。最近国际局势风云变换，以美国为首的西方构建的价值体系不断地被他们的各种操作证明：只要有利于他们，各种下三滥的手段都能够用上。美国最近拉拢一众企业制裁俄罗斯，包括但不限于苹果、谷歌、微软等，所以不得不防一手，万一哪天微软宣布github对中国用户关闭，也不要太过于惊讶。美国的政客真的是蠢到家了，自己构建的体系被自己的失信而一点点蚕食，早晚有崩塌的一天，我们拭目以待。</p></li></ol> <h2 id="_2022-03-09"><a href="#_2022-03-09" class="header-anchor">#</a> 2022.03.09</h2> <h3 id="使用-d3-绘制一张图表的步骤"><a href="#使用-d3-绘制一张图表的步骤" class="header-anchor">#</a> 使用 D3 绘制一张图表的步骤</h3> <p>使用D3画一个图标的步骤：</p> <p><img src="/Cherry/assets/img/d3-checklist.1d20834a.png" alt="D3画图标的步骤"></p> <p>下面对其做详细解释：</p> <h4 id="第一步-接入数据"><a href="#第一步-接入数据" class="header-anchor">#</a> 第一步：接入数据</h4> <p>这一步的目的主要是对数据结构进行分析，指定我们希望展示的值。</p> <p>比如有这样的一组数据：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">1526886000</span><span class="token punctuation">,</span>
    <span class="token string">&quot;summary&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mostly cloudy until evening.&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;partly-cloudy-day&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sunriseTime&quot;</span><span class="token operator">:</span> <span class="token number">1526905559</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sunsetTime&quot;</span><span class="token operator">:</span> <span class="token number">1526960941</span><span class="token punctuation">,</span>
    <span class="token string">&quot;moonPhase&quot;</span><span class="token operator">:</span> <span class="token number">0.23</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipIntensity&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipIntensityMax&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipProbability&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureHigh&quot;</span><span class="token operator">:</span> <span class="token number">68.8</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureHighTime&quot;</span><span class="token operator">:</span> <span class="token number">1526947200</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureLow&quot;</span><span class="token operator">:</span> <span class="token number">51.61</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureLowTime&quot;</span><span class="token operator">:</span> <span class="token number">1526990400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureHigh&quot;</span><span class="token operator">:</span> <span class="token number">68.8</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureHighTime&quot;</span><span class="token operator">:</span> <span class="token number">1526947200</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureLow&quot;</span><span class="token operator">:</span> <span class="token number">51.61</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureLowTime&quot;</span><span class="token operator">:</span> <span class="token number">1526990400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dewPoint&quot;</span><span class="token operator">:</span> <span class="token number">48.35</span><span class="token punctuation">,</span>
    <span class="token string">&quot;humidity&quot;</span><span class="token operator">:</span> <span class="token number">0.67</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pressure&quot;</span><span class="token operator">:</span> <span class="token number">1017.72</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windSpeed&quot;</span><span class="token operator">:</span> <span class="token number">3.33</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windGust&quot;</span><span class="token operator">:</span> <span class="token number">6.82</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windGustTime&quot;</span><span class="token operator">:</span> <span class="token number">1526950800</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windBearing&quot;</span><span class="token operator">:</span> <span class="token number">325</span><span class="token punctuation">,</span>
    <span class="token string">&quot;cloudCover&quot;</span><span class="token operator">:</span> <span class="token number">0.58</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uvIndex&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uvIndexTime&quot;</span><span class="token operator">:</span> <span class="token number">1526932800</span><span class="token punctuation">,</span>
    <span class="token string">&quot;visibility&quot;</span><span class="token operator">:</span> <span class="token number">9.59</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMin&quot;</span><span class="token operator">:</span> <span class="token number">52.45</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMinTime&quot;</span><span class="token operator">:</span> <span class="token number">1526907600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMax&quot;</span><span class="token operator">:</span> <span class="token number">68.8</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMaxTime&quot;</span><span class="token operator">:</span> <span class="token number">1526947200</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMin&quot;</span><span class="token operator">:</span> <span class="token number">52.45</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMinTime&quot;</span><span class="token operator">:</span> <span class="token number">1526907600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMax&quot;</span><span class="token operator">:</span> <span class="token number">68.8</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMaxTime&quot;</span><span class="token operator">:</span> <span class="token number">1526947200</span><span class="token punctuation">,</span>
    <span class="token string">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-05-21&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">1526972400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;summary&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Clear throughout the day.&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;clear-day&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sunriseTime&quot;</span><span class="token operator">:</span> <span class="token number">1526991898</span><span class="token punctuation">,</span>
    <span class="token string">&quot;sunsetTime&quot;</span><span class="token operator">:</span> <span class="token number">1527047412</span><span class="token punctuation">,</span>
    <span class="token string">&quot;moonPhase&quot;</span><span class="token operator">:</span> <span class="token number">0.27</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipIntensity&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipIntensityMax&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precipProbability&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureHigh&quot;</span><span class="token operator">:</span> <span class="token number">75.67</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureHighTime&quot;</span><span class="token operator">:</span> <span class="token number">1527033600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureLow&quot;</span><span class="token operator">:</span> <span class="token number">54.07</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureLowTime&quot;</span><span class="token operator">:</span> <span class="token number">1527080400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureHigh&quot;</span><span class="token operator">:</span> <span class="token number">75.67</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureHighTime&quot;</span><span class="token operator">:</span> <span class="token number">1527033600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureLow&quot;</span><span class="token operator">:</span> <span class="token number">54.07</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureLowTime&quot;</span><span class="token operator">:</span> <span class="token number">1527080400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dewPoint&quot;</span><span class="token operator">:</span> <span class="token number">50.44</span><span class="token punctuation">,</span>
    <span class="token string">&quot;humidity&quot;</span><span class="token operator">:</span> <span class="token number">0.64</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pressure&quot;</span><span class="token operator">:</span> <span class="token number">1013.35</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windSpeed&quot;</span><span class="token operator">:</span> <span class="token number">3.69</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windGust&quot;</span><span class="token operator">:</span> <span class="token number">7.3</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windGustTime&quot;</span><span class="token operator">:</span> <span class="token number">1527030000</span><span class="token punctuation">,</span>
    <span class="token string">&quot;windBearing&quot;</span><span class="token operator">:</span> <span class="token number">330</span><span class="token punctuation">,</span>
    <span class="token string">&quot;cloudCover&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uvIndex&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uvIndexTime&quot;</span><span class="token operator">:</span> <span class="token number">1527019200</span><span class="token punctuation">,</span>
    <span class="token string">&quot;visibility&quot;</span><span class="token operator">:</span> <span class="token number">9.84</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMin&quot;</span><span class="token operator">:</span> <span class="token number">51.61</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMinTime&quot;</span><span class="token operator">:</span> <span class="token number">1526990400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMax&quot;</span><span class="token operator">:</span> <span class="token number">75.67</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperatureMaxTime&quot;</span><span class="token operator">:</span> <span class="token number">1527033600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMin&quot;</span><span class="token operator">:</span> <span class="token number">51.61</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMinTime&quot;</span><span class="token operator">:</span> <span class="token number">1526990400</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMax&quot;</span><span class="token operator">:</span> <span class="token number">75.67</span><span class="token punctuation">,</span>
    <span class="token string">&quot;apparentTemperatureMaxTime&quot;</span><span class="token operator">:</span> <span class="token number">1527033600</span><span class="token punctuation">,</span>
    <span class="token string">&quot;date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2018-05-22&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>我们需要取出这组数据的<code>temperatureMax</code>和<code>date</code>，可以定义如下两个函数作为访问器：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> dateFormatString <span class="token operator">=</span> <span class="token string">&quot;%Y-%m-%d&quot;</span>
<span class="token keyword">const</span> dateParser <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">timeParse</span><span class="token punctuation">(</span>dateFormatString<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">xAccessor</span> <span class="token operator">=</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">dateParser</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">yAccessor</span> <span class="token operator">=</span> <span class="token parameter">d</span> <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>temperatureMax
</code></pre></div><p>其中<code>xAccessor</code>和<code>yAccessor</code>就是两个访问器，通过这两个访问器，就可以获取到想要的值。accessor并不是D3的概念，只不过是在实现图表的过程中，需要多次用到这样的逻辑，所以将其抽出，使代码更容易维护。</p> <h4 id="第二步-定义图表的空间参数"><a href="#第二步-定义图表的空间参数" class="header-anchor">#</a> 第二步：定义图表的空间参数</h4> <p>图表空间主要包括两部分：<code>wrapper</code>和<code>bounds</code>。</p> <p><code>wrapper</code>指的是所有的<code>SVG</code>元素，包括坐标轴、数据元素和图例等。
<code>bounds</code>在<code>wrapper</code>内部，比<code>wrapper</code>要小，只包括数据元素。</p> <p>定义空间参数就是定义<code>wrapper</code>和<code>bounds</code>的大小，而<code>bounds</code>的大小不是直接指定的，而是根据其边缘宽度计算而来，这样不仅知道了<code>bounds</code>的大小，而且知道了其相对于<code>wrapper</code>的位置。</p> <p>下面看一张示意图，来加深理解：</p> <p><img src="/Cherry/assets/img/d3-wrapper-bounds.1d896241.png" alt="wrapper &amp; bounds"></p> <p>代码实现如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> dimensions <span class="token operator">=</span> <span class="token punctuation">{</span>
  width<span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  margin<span class="token operator">:</span> <span class="token punctuation">{</span>
    top<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
    right<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
    bottom<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
    left<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
dimensions<span class="token punctuation">.</span>boundedWidth <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>width <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>right
dimensions<span class="token punctuation">.</span>boundedHeight <span class="token operator">=</span> dimensions<span class="token punctuation">.</span>height <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top <span class="token operator">-</span> dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>bottom
</code></pre></div><h4 id="第三步-绘制wrapper和bounds"><a href="#第三步-绘制wrapper和bounds" class="header-anchor">#</a> 第三步：绘制<code>wrapper</code>和<code>bounds</code></h4> <p>先把主体轮廓绘制出来，再绘制细节，代码实现如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;#wrapper&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;width&quot;</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> dimensions<span class="token punctuation">.</span>height<span class="token punctuation">)</span>

  <span class="token comment">// 使用 g 元素来包裹里面的元素，从而一次性实现坐标转换</span>
  <span class="token comment">// 可以把 g 元素当做 div，此时的g元素渲染出来的是一个 0*0 的元素，它的大小是根据里面的内容撑开的</span>
  <span class="token keyword">const</span> bounds <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">&quot;transform&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
      dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>left
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
      dimensions<span class="token punctuation">.</span>margin<span class="token punctuation">.</span>top
    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>这里需要注意<code>.attr()</code>和<code>.style()</code>函数，前者可以设定元素的属性，后者可以设定元素的内联css值，这里内联css值要比元素属性的优先级高。</p> <h4 id="第四步-绘制比例尺"><a href="#第四步-绘制比例尺" class="header-anchor">#</a> 第四步：绘制比例尺</h4> <p><strong>比例尺</strong>是D3中非常重要的概念，它的作用是将真实数据映射为画布上的像素值。</p> <p>比如我们要把<code>[0, 100]</code>范围的真实数据映射为<code>[200, 100]</code>范围的像素值，可以如下定义</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> scale <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">scaleLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>   
</code></pre></div><p>其中，<code>scale</code>是一个函数，比如现在我们有个数据为<code>55</code>，要想知道其对应的像素值，就可以做如下计算：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pixelValue <span class="token operator">=</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pixelValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 145</span>
</code></pre></div><h4 id="第五步-绘制数据图形"><a href="#第五步-绘制数据图形" class="header-anchor">#</a> 第五步：绘制数据图形</h4> <p>这一步我需要往刚才定义的bounds里绘制我们需要的图形了，可以绘制各种各样svg支持的图形，由于每种图形都对应着不同的属性，为方便查阅，整理如下图片：</p> <p><img src="/Cherry/assets/img/svg-element.7e2df393.png" alt="svg元素对应的属性"></p> <p>以折线图为例，我们可以做如下操作：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> lineGenerator <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Creates a generator that converts data points into a d string</span>
    <span class="token comment">// Transform our data point with the appropriate accessor and the scale to get the scaled value in pixel space</span>
    <span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">xScale</span><span class="token punctuation">(</span><span class="token function">xAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token function">yScale</span><span class="token punctuation">(</span><span class="token function">yAccessor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> line <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// Feed our dataset to our line generator function</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token function">lineGenerator</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// SVG elements default to a black fill and no stroke; which gives us a filled in shape unless we add styling</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;fill&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#af9358&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;stroke-width&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>当然这里面有很多细节需要注意，这需要在实现的过程中再深入进去，这里不做过多阐述</p> <h4 id="第六步-绘制配件"><a href="#第六步-绘制配件" class="header-anchor">#</a> 第六步：绘制配件</h4> <p>配件主要包括坐标轴、标签、图例等，以坐标轴为例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// Draw y axis tick marks and labels</span>
  <span class="token keyword">const</span> yAxisGenerator <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">axisLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// We want labels of the y-axis to be to the left of the axis line</span>
    <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>yScale<span class="token punctuation">)</span>
  <span class="token comment">// Our axis generator will create lots of element; create a g element to contain them and keep our DOM organized</span>
  <span class="token keyword">const</span> yAxis <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>yAxisGenerator<span class="token punctuation">)</span>

</code></pre></div><h4 id="第七步-设置交互"><a href="#第七步-设置交互" class="header-anchor">#</a> 第七步：设置交互</h4> <p>这一步需要做一些事件的监听等操作。</p> <p>以上就是使用D3绘制一张图表的步骤，遵循此步骤，就可以使你有条不紊地绘制出一张你想要可视化的图。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/9/2022, 9:26:32 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Cherry/assets/js/app.5a1e4f07.js" defer></script><script src="/Cherry/assets/js/2.887b5b9f.js" defer></script><script src="/Cherry/assets/js/5.ceb362cc.js" defer></script>
  </body>
</html>

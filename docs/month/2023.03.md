# 万物复苏之际

## 浏览器事件循环

温故而知新，今天看到浏览器事件循环的一些事情，发现以前的理解有些偏差，问题发现在如下代码：

```javascript
console.log('1')
setTimeout(() => {
  console.log('4')
  Promise.resolve().then(function() {
    console.log('5')
  })
}, 0)
setTimeout(() => {
  console.log('6')
  Promise.resolve().then(function() {
    console.log('7')
  })
}, 0)
Promise.resolve().then(function() {
  console.log('3')
})
console.log('2')
```

打印的顺序即如数字的顺序，但是一开始我以为是`1,2,3,4,6,5,7`这个顺序，也就是使说当时理解为先将宏任务队列清空，再执行微任务队列，但这种理解是错误的。

正确的理解是：

> 事件循环中的宏任务和微任务的执行顺序如下：
>
> 1. 执行当前宏任务中的同步代码
>
> 2. 将所有微任务添加到微任务队列中
>
> 3. 执行微任务队列中的所有微任务，直到微任务队列为空
>
> 4. 重复步骤1-3，直到宏任务队列为空

也就是说，每次宏任务执行都是执行一个，接下来立即清空任务队列，再继续执行宏任务，一直循环，就是所谓的`事件循环`。

这里可以看到，设计微任务的目的就是在执行异步任务的时候可以实现插队的操作，所以有一种说法是微任务比宏任务快，原因就是这么来的。


